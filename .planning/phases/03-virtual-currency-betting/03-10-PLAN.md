---
phase: 03-virtual-currency-betting
plan: 10
type: execute
wave: 5
depends_on: ["03-07", "03-08", "03-09"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "New user receives starting balance from SystemSettings"
    - "Admin can override starting balance at invitation"
    - "Balance visible on every page in sidebar"
    - "Room creator can create free or bet rooms with min/max bet"
    - "Bet room buy-in deducted, refunded, or forfeited correctly"
    - "Game end pays out winners per payout ratios"
    - "AFK in bet room shows grace period warning before kick"
    - "User can send chips from wallet page or from player card"
    - "Admin can manage economy from finance page"
    - "Admin balance adjustments notify affected users in real-time"
    - "All balance changes logged as transactions"
---

<objective>
Full verification checkpoint for Phase 3: Virtual Currency and Betting.

Purpose: Verify all Phase 3 success criteria are met through end-to-end testing of the complete virtual currency system. This covers wallet creation, daily claims, transfers, betting lifecycle, admin controls, and economic configuration.

Output: Verification results confirming all GUTH requirements are satisfied.
</objective>

<execution_context>
@/home/maxi/.claude/get-shit-done/workflows/execute-plan.md
@/home/maxi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Full Phase 3 verification checkpoint</name>
  <files></files>
  <action>
Present the following verification checklist to the user and await their confirmation.

Complete virtual currency and betting system to verify:
- Wallet system with automatic creation and starting balance
- Admin can override starting balance when inviting a user
- Sidebar balance widget with animated counter and popover
- Wallet page with balance chart, transaction history, daily claim, P2P transfers
- Free/bet room toggle in room creation with preset amounts, custom input, and min/max bet
- Lobby filter tabs (All/Free/Bet) with chip badges on bet rooms
- Escrow lifecycle: buy-in on join, refund before start, forfeit mid-game, payout on game end
- Bet confirmation dialog for high-stakes bets (>25% of balance)
- AFK grace period warning banner with countdown before kick/forfeit in bet rooms
- Pot display on game board during gameplay
- Payout breakdown on results screen
- Player card "Chips senden" button opens transfer dialog pre-filled with recipient
- Admin finance page: economy dashboard, transaction log, balance tools, system settings, alerts
- Admin wallet freeze/unfreeze
- Admin balance adjustments notify affected users in real-time
- Activity-scaled daily allowance with weekly bonus

Test scenarios (start dev server with `npm run dev`):

1. Wallet Creation (GUTH-01): Register new user, verify starting balance in sidebar and /wallet
2. Custom Starting Balance (GUTH-01): Admin invites user with custom starting balance, new user registers, verify they receive the custom amount (not the global default)
3. Balance Visibility (GUTH-02): Navigate pages, verify widget on every page, hover popover works
4. Daily Allowance: Claim on /wallet, verify animation, verify disabled after claim
5. P2P Transfer (wallet): Send chips from /wallet, verify both balances update, both see transactions
6. P2P Transfer (player card): In a game waiting room, hover a player, click "Chips senden", verify TransferDialog opens pre-filled with that player, complete transfer
7. Room Creation (GUTH-05): Create free room (Kostenlos badge), create bet room (chip badge), set min/max bet, filter tabs
8. Bet Lifecycle: Join bet room (deducted), leave before start (refunded), play to end (payout)
9. High-Stakes (GUTH-06): Bet >25% of balance, verify confirmation dialog
10. Insufficient Balance: Low-balance user joins expensive room as spectator
11. AFK Warning: Go AFK in a bet room, verify warning banner appears with countdown and "Ich bin da!" button
12. Admin Finance (GUTH-03/04): Dashboard, adjust balance, verify affected user's sidebar updates in real-time
13. System Settings: Change currency name, verify updates; change starting balance, test new user
14. Wallet Freeze: Freeze user, verify transfer blocked but free play works, unfreeze
  </action>
  <verify>User confirms all 14 scenarios pass or reports specific issues.</verify>
  <done>All GUTH-01 through GUTH-06 requirements verified. Full betting lifecycle works end-to-end. Admin has complete economic control. P2P transfers work from wallet and player cards. AFK grace period warning works. All balance changes tracked with descriptive German text.</done>
</task>

</tasks>

<verification>
Phase 3 success criteria:
1. New user receives starting balance (from SystemSettings, admin configurable, overridable at invitation)
2. User sees current balance on every page
3. Room creator can set optional bet amount with min/max
4. System validates sufficient balance before bet
5. High-stakes bets show confirmation dialog
6. AFK in bet rooms shows grace period warning before kick
7. Admin can add or remove balance (with real-time notification to user)
8. User can send chips from wallet or from player cards
9. All balance changes logged in transaction history
</verification>

<success_criteria>
All GUTH-01 through GUTH-06 requirements verified. Full betting lifecycle works end-to-end. Admin has complete economic control. All balance changes tracked.
</success_criteria>

<output>
After completion, create `.planning/phases/03-virtual-currency-betting/03-10-SUMMARY.md`
</output>
